name: Module Builder Docker Image
on: [pull_request]
jobs:
  build_and_push:
    name: Test Module Builder Image
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2.1.0
      - name: Build
        run: |
          pwd
          ls
          [ ! -f docs/guide/buildspec.ym ] && echo "docs/guide/buildspec.ym does not exist" && exit 1
          docker build -t module-builder-test -f build/module-builder/Dockerfile .
          docker run -v `pwd`/modules/channel-web:/botpress/modules/channel-web module-builder-test sh -c 'cd modules/channel-web && yarn && yarn build && yarn package'
          ls modules/channel-web
          echo "before"
          echo "testing package.json exists"
          test -f modules/channel-web/package.json
          echo "testing package.json does not exist"
          test ! -f modules/channel-web/package.json
          echo "testing channel-web.tgz does not exist"
          test ! -f modules/channel-web/channel-web.tgz
          echo "after"
          echo $?
